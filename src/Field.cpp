#include "WinMain.h"
#include "Vector3.h"
#include "Vector2.h"
#include "Base.h"
#include "Object.h"
#include "Field.h"


// フィールドのオブジェクトを置く座標 
constexpr int MAP_W = 10;  // 縦
constexpr int MAP_H = 10;  // 横

// 1が壁０が何もない
// フィールドのオブジェクトを置く座標用の二次元配列
int MapData[MAP_H][MAP_W]
{
	{ 1,1,1,1,1,1,1,1,1,1},
	{ 1,0,0,0,0,0,0,0,0,1},
	{ 1,0,0,1,0,0,1,0,0,1},
	{ 1,0,0,0,0,0,0,0,0,1},
	{ 1,0,0,1,0,0,1,0,0,1},
	{ 1,0,0,0,0,0,0,0,0,1},
	{ 1,0,0,1,0,0,1,0,0,1},
	{ 1,0,0,0,0,0,0,0,0,1},
	{ 1,0,0,1,0,0,1,0,0,1},
	{ 1,1,1,1,1,1,1,1,1,1},
};
//	初期化処理
Field::Field()
{
	//// ここでフィールドモデルの読み込みをする
	//m_model = MV1LoadModel("Data/Model/Field/z.mv1");
	m_pos.set(0 + MODEL_SIZE* 15,0.0f, 0 + MODEL_SIZE * 15); // 描画座標の設定
	m_rot.clear(); // 回転量の 
}

//---------------------------------------------------------------------------
//---------------------------------------------------------------------------
void Field::Init()
{
	// ここでフィールドモデルの読み込みをする
	m_model = MV1LoadModel("Data/Model/Field/Ground_2.mv1");
	obj_max = Field_Init();

	// オブジェクトの初期設定
	for (int i = 0; i < obj_max; ++i) {
		// ここでNEWする
		Object* object = new Object;
		// 追加登録(これでオブジェクトクラスの配列が増えていく)
		objects.push_back(object);
		// delete object; // objectの解放
	}

	Field_Init();  // フィールド上にオブジェクトの置く数を返す
	Object_Init(); // オブジェクトの座標、サイズの初期設定
}

//---------------------------------------------------------------------------
// フィールド上にオブジェクトの置く数を返す
//---------------------------------------------------------------------------
int Field::Field_Init()
{

	// 何個のオブジェクトが必要か数える
	int object_count = 0;
	for (int h = 0; h < MAP_H; h++) {
		for (int w = 0; w < MAP_W; w++) {
			if (MapData[h][w] == 1) {
				object_count++;
			}
		}
	}
	return object_count; // 何個のオブジェクトが必要か返す
}

//---------------------------------------------------------------------------
// オブジェクトの座標、サイズの初期設定
//---------------------------------------------------------------------------
void Field::Object_Init()
{
	// 何個めオブジェクトか数える
	int object_count = 0;
	for (int h = 0; h < MAP_H; h++) {
		for (int w = 0; w < MAP_W; w++) {
			if (MapData[h][w] == 1) {
				// 最初の０個目を触るために上に置く
				objects[object_count]->Field_Object_Init(m_field_size, h, w);
				object_count++; // 次の分のカウントを進めておく
			}
		}
	}

}

//---------------------------------------------------------------------------
//	更新処理
//---------------------------------------------------------------------------
void Field::Update()
{

}

//---------------------------------------------------------------------------
//	描画処理
//---------------------------------------------------------------------------
void Field::Draw()
{
	// フィールドモデルの描画座標
	MV1SetPosition(m_model, VGet(m_pos.x, m_pos.y, m_pos.z));
	// フィールドの回転
	MV1SetRotationXYZ(m_model, VGet(TO_RADIAN(m_rot.x), TO_RADIAN(m_rot.y), TO_RADIAN(m_rot.z)));
	// モデルの大きさ
	MV1SetScale(m_model, VGet(MODEL_SIZE, MODEL_SIZE, MODEL_SIZE));
	// モデルの描画
	MV1DrawModel(m_model);

	for (int i = 0; i < obj_max; i++) {
		objects[i]->Draw();
	}
}

//---------------------------------------------------------------------------
//	終了処理
//---------------------------------------------------------------------------
void Field::Exit()
{
	// モデルデータの削除
	MV1DeleteModel(m_model);

	// オブジェクトの配列の解放
	objects.clear();
}


